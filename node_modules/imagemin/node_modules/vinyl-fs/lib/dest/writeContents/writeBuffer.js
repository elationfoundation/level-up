'use strict';

<<<<<<< HEAD
var fo = require('../../fileOperations');

function writeBuffer(writePath, file, written) {
  var opt = {
    mode: file.stat.mode,
    flag: file.flag,
  };

  fo.writeFile(writePath, file.contents, opt, onWriteFile);

  function onWriteFile(writeErr, fd) {
    if (writeErr) {
      return fo.closeFd(writeErr, fd, written);
    }

    fo.updateMetadata(fd, file, onUpdate);
  }

  function onUpdate(statErr, fd) {
    fo.closeFd(statErr, fd, written);
  }
=======
var fs = require('graceful-fs');

var futimes = require('../../futimes');

function writeBuffer(writePath, file, cb) {
  var stat = file.stat;

  fs.open(writePath, file.flag, stat.mode, function(err, fd) {
    if (err) {
      return cb(err);
    }

    fs.write(fd, file.contents, 0, file.contents.length, 0, function(error) {
      if (error) {
        return complete(error);
      }
      futimes(fd, stat, complete);
    });

    // Cleanup
    function complete(err1) {
      fs.close(fd, function(err2) {
        cb(err1 || err2);
      });
    }
  });
>>>>>>> 16a22f1a2827e4eddfc089d7e2423b046879a4ce
}

module.exports = writeBuffer;
