<<<<<<< HEAD
"use strict";

var stream = require("readable-stream");

function DuplexWrapper(options, writable, readable) {
=======
var stream = require("readable-stream");

var duplex2 = module.exports = function duplex2(options, writable, readable) {
  return new DuplexWrapper(options, writable, readable);
};

var DuplexWrapper = exports.DuplexWrapper = function DuplexWrapper(options, writable, readable) {
>>>>>>> 16a22f1a2827e4eddfc089d7e2423b046879a4ce
  if (typeof readable === "undefined") {
    readable = writable;
    writable = options;
    options = null;
  }

<<<<<<< HEAD
  stream.Duplex.call(this, options);

  if (typeof readable.read !== "function") {
    readable = (new stream.Readable(options)).wrap(readable);
  }

  this._writable = writable;
  this._readable = readable;
  this._waiting = false;
=======
  options = options || {};
  options.objectMode = true;

  stream.Duplex.call(this, options);

  this._bubbleErrors = (typeof options.bubbleErrors === "undefined") || !!options.bubbleErrors;

  this._writable = writable;
  this._readable = readable;
>>>>>>> 16a22f1a2827e4eddfc089d7e2423b046879a4ce

  var self = this;

  writable.once("finish", function() {
    self.end();
  });

  this.once("finish", function() {
    writable.end();
  });

<<<<<<< HEAD
  readable.on("readable", function() {
    if (self._waiting) {
      self._waiting = false;
      self._read();
=======
  readable.on("data", function(e) {
    if (!self.push(e)) {
      readable.pause();
>>>>>>> 16a22f1a2827e4eddfc089d7e2423b046879a4ce
    }
  });

  readable.once("end", function() {
<<<<<<< HEAD
    self.push(null);
  });

  if (!options || typeof options.bubbleErrors === "undefined" || options.bubbleErrors) {
    writable.on("error", function(err) {
      self.emit("error", err);
    });

    readable.on("error", function(err) {
      self.emit("error", err);
    });
  }
}

=======
    return self.push(null);
  });

  if (this._bubbleErrors) {
    writable.on("error", function(err) {
      return self.emit("error", err);
    });

    readable.on("error", function(err) {
      return self.emit("error", err);
    });
  }
};
>>>>>>> 16a22f1a2827e4eddfc089d7e2423b046879a4ce
DuplexWrapper.prototype = Object.create(stream.Duplex.prototype, {constructor: {value: DuplexWrapper}});

DuplexWrapper.prototype._write = function _write(input, encoding, done) {
  this._writable.write(input, encoding, done);
};

<<<<<<< HEAD
DuplexWrapper.prototype._read = function _read() {
  var buf;
  var reads = 0;
  while ((buf = this._readable.read()) !== null) {
    this.push(buf);
    reads++;
  }
  if (reads === 0) {
    this._waiting = true;
  }
};

module.exports = function duplex2(options, writable, readable) {
  return new DuplexWrapper(options, writable, readable);
};

module.exports.DuplexWrapper = DuplexWrapper;
=======
DuplexWrapper.prototype._read = function _read(n) {
  this._readable.resume();
};
>>>>>>> 16a22f1a2827e4eddfc089d7e2423b046879a4ce
